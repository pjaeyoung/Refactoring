# Chapter 02 리팩터링 원칙

## 2.1 리팩터링 정의

> 리팩터링: 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법

## 2.2 두 개의 모자

- 기능 추가 : 기존 코드를 건드리지 않고 새 기능을 추가
- 리팩터링 : 새 기능을 추가하지 않고 오로지 코드 재구성에만 전념

## 2.3 리팩터링하는 이유

- 소프트웨어 설계(아키택처)가 좋아진다
  - 중복 코드 제거 => 코드량 감소 => 코드 이해에 걸리는 시간 감소 => 수정 용이
- 소프트웨어를 이해하기 쉬워진다.
  - 컴퓨터에게 시킬 일과 이를 표현할 코드의 차이 줄이기
  - 나중에 그 코드를 다룰 개발자(나 자신 포함) 배려
- 버그를 쉽게 찾을 수 있다
- 프로그래밍 속도를 높일 수 있다
  - 내부 설계가 잘 된 소프트웨어는 새 기능 추가 지점과 고칠 부분을 쉽게 찾을 수 있음

## 2.4 언제 리팩터링해야 할까?

### 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기

- 리팩터링하기 가장 좋은 시점은 코드베이스에 기능을 새로 추가하기 직전
- 구조를 살짝 바꾸면 다른 작업을 하기 훨씬 쉬워질 만한 부분 찾기
  - ex) 요구사항을 거의 만족하나 리터럴 몇 개가 방해되는 함수

### 이해를 위한 리팩터링: 코드를 이해하기 쉽게 만들기

- 코드 수정하기 전 코드가 하는 일 파악
- 코드의 의도가 명확하게 드러나도록 리팩터링할 여지가 있는가?
  - ex) 함수명이 실제로 하는 일을 파악하기 어려운가

### 쓰레기 줍기 리팩토링

- 간단히 수정할 수 있는 것은 즉시 고치고 시간이 좀 걸리는 일은 짧은 메모만 남긴 다음 하던 일을 끝내고 나서 처리하기

### 계획된 리팩토링과 수시로 하는 리팩토링

- 리팩토링 일정을 따로 잡아두지 않고 프로그래밍 과정에서 자연스럽게 녹임
- 보기 싫은 코드 뿐만 아니라 잘 작성된 코드 역시 리팩토링 대상
- 새 기능을 추가하는 일은 새로 작성해서 넣는 코드보다 기존 코드의 수정량이 큰 경우가 많다

### 오래 걸리는 리팩터링

- 팀 전체가 리팩토링하기보다 몇 주에 걸쳐 조금씩 해결하기

### 코드리뷰에 리팩터링 활용하기

- 코드 리뷰의 결과를 더 구체적으로 도출하는 데 도움 => 개선안들을 제시하는 데서 그치지 않고, 즉시 구현

## 2.5 리팩터링과 소프트웨어 개발 프로세스

- 익스트림 프로그래밍(XP) : 당장에 필요한 기능만으로 최대한 간결하게 만들기, 앞으로 필요할 것 같아서 미리 구현해둔 기능(유연성 매커니즘) 상당수가 전혀 쓰이지 않거나 수정하기 더 어려워지는 경우가 많음. 자가 테스트 코드 + 지속적인 통합(CI) : 팀원 각자가 수행한 리팩터링 결과를 빠르게 동료와 공유할 수 있음 + 리팩터링 기법을 하나로 묶은 프로세스

## 2.6 리팩터링과 성능

### 성능 최적화 방법

1. 시간 예산 분배방식

- 설계를 여러 컴포넌트로 나눠 컴포넌트마다 자원(시간,공간) 예산을 할당
- 할당된 자원 예산 초과할 수 없음

2. 끊임없이 관심 기울이기

- 대부분 프로그램은 전체 코드 중 극히 일부에서 대부분의 시간을 소비함
- 코드 전체를 고르게 최적화한다면 그중 90%는 효과가 거의 없기 때문에 시간 낭비

3. 의도적으로 성능 최적화에 돌입하기 전까지 성능에 신경쓰지 않고 코드를 다루기 쉽게 만드는데 집중하기

- 프로파일러로 프로그램 분석하여 시간과 공간을 많이 잡아먹는 지점 찾은 수 해당 부분만 성능 최적화
- 성능에 큰 영향을 주는 부분만 집중해서 최적화하기 때문에 적은 노력으로 큰 효과를 볼 수 있음
