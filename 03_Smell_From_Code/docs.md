# Chapter 03 코드에서 나는 악취

리팩토링 시작 시점은 코드에서 악취가 날 때다.
어떤 코드들이 악취가 나며 어떤 대응을 해야할 지 아래에 요약했다.

## 3.1 명료하지 않은 이름

동작 방식이 아닌 의도/목적이 드러나는 이름짓기

- **함수 선언 바꾸기**
- **변수 이름 바꾸기**
- **필드 이름 바꾸기**

## 3.2 중복 코드

- **함수 추출하기** : 똑같은 표현식을 추출된 함수 호출로 대체
- 코드가 완전히 동일하지 않으면 **문장 슬라이드** 후 함수 추출하기
- **메서드 올리기** : 같은 부모로 파생된 서브 클래스에 코드 중복 시 적용

## 3.3 긴 함수

함수가 길수록 이해하기 어려움, 긴 코드일수록 코드 전체를 아우르는 이름 짓기 힘듬

- **함수 추출하기** : 함수를 짧게 만드는 작업의 99% 차지
- 임시 변수는 추출작업에 방해 => **임시 변수를 질의함수로 바꾸기**
- 함수 추출과정에서 매개변수 많아질 때 **매개변수 객체 만들기**, **객체 통째로 넘기기** 로 매개 변수 수 줄이기
- 여전히 임시 변수와 매개변수가 많다면 **함수를 명령으로 바꾸기**
- 추출할 코드 덩어리

  - 주석이 설명하는 코드
  - 조건문 => **조건문 분해하기**, **조건문을 다형성으로 바꾸기**
  - 반복문 => **반복문 쪼개기**

  ## 3.4 긴 매개변수 목록

  - **매개 변수를 질의함수로 바꾸기**
  - **객체 통째로 넘기기**
  - **매개변수 객체로 만들기**
  - **플래그 인수 제거하기**
  - **여러 함수를 클래스로 묶기** : 여러 함수가 특정 매개변수들의 값을 공통으로 사용할 경우

  ## 3.5 전역 데이터

  - **변수 캡슐화** : 접근자 함수들을 클래스나 모듈에 넣어 접근 범위 최소화

  ## 3.6 가변 데이터

  - **변수 캡슐화** : 값 수정여부 감시, 코드 개선 쉬움
  - **변수 쪼개기** : 용도별로 독립 변수에 저장하여 값 갱신 문제 일으킬 여지 없애기
  - **문장슬라이드하기** + **함수 추출하기** : 갱신하는 코드와 부작용이 없는 코드 분리
  - **질의 함수와 변경함수 분리하기**
  - **세터 제거하기**
  - **파생변수를 질의함수로 바꾸기**
  - **여러 함수를 클래스로 묶기**, **여러 함수를 변환함수로 묶기** : 변수 갱신 코드의 유효범위를 클래스나 변환으로 제한
  - **참조를 값으로 바꾸기**

  ## 3.7 뒤엉킨 변경

  단일 책임 원칙이 제대로 지켜지지 않을 때 나타남, 단일 모듈은 변경의 이유가 오직 하나

  - **단계 쪼개기** : 순차적으로 처리해야하는 로직이면 다음 맥락에 필요한 데이터를 특정한 데이터 구조에 담아 전달하는 식으로 단계 분리
  - **함수 옮기기** : 전체 처리 과정 곳곳에서 각기 다른 맥락의 함수를 호출하는 빈도가 높다면, 각 맥락에 해당하는 적당한 모듈들을 만들어서 관련 함수들 모으기, 이때 여러 일에 관여하는 함수가 있다면 옮기기 전에 **함수 추출하기**
  - **클래스 추출하기** : 모듈이 클래스 일 경우

## 3.8 산탄총 수술

- 변경할 부분이 코드 전반에 분산된 경우
- **함수 옮기기**, **필드 옮기기** : 함께 변경되는 대상들을 모두 한 모듈에 묶어두기
- **여러 함수를 클래스로 묶기** : 비슷한 데이터를 다루는 함수가 많을 경우
- **여러 함수를 변환 함수로 묶기** : 데이터 구조를 변환하거나 보강하는 함수들에 적용
- **단계 쪼개기** : 묶은 함수들의 출력 결과를 다음 단계의 로직에 전달할 수 있을 경우
- **함수 인라인하기**, **클래스 인라인하기**

## 3.9 기능 편애

프로그램 모듈화는 코드를 여러 영역으로 나눈 뒤 영역 안의 상호작용은 최대화, 영역 사이의 상호작용은 최소화,
기능편애는 외부와의 상호작용이 더 많을 때 생김

- **함수 옮기기** : 상호작용 많은 데이터 근처로 옮기기
- **함수 추출하기** 후 **함수 옮기기** : 함수의 일부만 기능 편애시

## 3.10 데이터 뭉치

데이터 뭉치는 단독으로 의미를 갖지 못하는 데이터들

- **클래스 추출하기** : 필드 형태의 데이터 뭉치의 경우
- **매개변수 객체 만들기**, **객체 통째로 옮기기** : 메서드 매개변수의 데이터 뭉치인 경우

## 3.11 기본형 집착

- **기본형을 객체로 바꾸기**
- **타입코드를 서브클래스로 바꾸기** ,**조건부 로직을 다형성으로 바꾸기**: 기본형으로 표현된 코드가 조건부 동작을 제어하는 타입 코드로 쓰였을 경우
- 자주 함께 몰려다니는 기본형 그룹도 데이터 뭉치 => **클래스 추출하기** , **매개변수 객체 만들기**

## 3.12 반복되는 switch문

똑같은 조건부 로직이 여러 곳에서 반복해 등장하는 코드 => 조건절이 추가할 때마다 다른 switch/조건문에 추가해야 함 => **조건부 로직을 다형성으로 바꾸기**

## 3.13 반복문

- **반복문을 파이프라인으로 바꾸기**

## 3.14 성의 없는 요소

본문 코드를 그대로 쓰는 함수, 실질적으로 메서드가 하나뿐인 클래스

- **함수 인라인하기**
- **클래스 인라인하기**
- **계층 합치기**

## 3.15 추측성 일반화

미래를 위해 작성했으나 쓰이지 않는 코드

- **계층 합치기**
- **함수 인라인하기**
- **클래스 인라인하기**
- **함수 선언 바꾸기**
- **죽은 코드 제거하기**

## 3.16 임시 필드

특정 상황에서만 값이 설정되는 필드가 존재할 경우

- 임시 필드로 구성된 **클래스 추출하기**, 임시필드와 관련된 **함수 옮기기**
- **특이 케이스추가하기** : 임시 필드 유효성 검사 후 동작하는 조건부 로직에서 유효하지 않을 경우 대안 클래스 만들기

## 3.17 메시지 체인

객체 프로퍼티를 여러 차례 걸쳐 접근하는 작업

- **위임 숨기기** : 결과 객체를 사용하는 코드를 **함수 추출하기**, **함수 옮기기**

## 3.18 중개자

- 클래스가 제공하는 메서드 중 절반이 다른 클래스에 위임하고 있다면 **중개자 제거하기**로 직접 소통
- 위임 메서드 제거 후 남는 일이 없으면 **함수 인라인하기**

## 3.19 내부자 거래

모듈간 데이터 거래양이 많을수록 모듈의 결합도 상승

- **함수 옮기기**, **필드 옮기기**
- 여러 모듈이 같은 관심사를 공유하면 공통부분을 처리하는 제 3의 모듈 생성 혹은 **위임 숨기기**
- 상속구조에서 **서브클래스를 위임으로 바꾸기**, **슈퍼클래스를 위임으로 바꾸기**

## 3.20 거대한 클래스

- 필드량이 많은 클래스
  - **클래스 추출하기**로 필드 일부를 분리
  - 원래 클래스와 상속 관계로 만드는 게 좋다면 **슈퍼 클래스 추출하기**, **타입 코드를 서브클래스로 바꾸기**
- 코드량이 많은 클래스
  - 기존 메서드들의 공통부분을 작은 메서드들로 쪼개서 작은 메서드들을 호출하도록 변경
- 클라이언트들이 거대 클래스를 이용하는 패턴 파악
  - 특정 기능 그룹이 주로 사용될 때 개별 클래스로 추출

## 3.21 서로 다른 인터페이스의 대안 클래스

인터페이스가 같으면 다른 클래스의 인스턴스들이라도 같게 인식하고 처리하는 자바스크립트 특징 활용

- **함수 선언 바꾸기** 로 인터페이스 일치시키기

## 3.22 데이터 클래스\*

데이터 클래스는 데이터 필드와 게터/세터 메서드로만 구성된 클래스
다른 클래스가 함부로 제어할 가능성 존재

- **레코드 캡슐화하기**, **세터 제거하기**로 접근 봉쇄
- 다른 클래스에서 데이터 클래스의 게터나 세터를 사용하는 메서드를 찾아 **함수 옮기기**, 통째로 옮기기 어렵다면 일부분만 **함수 추출하기** 후 옮기기

## 3.23 상속 포기

일부 프로퍼티와 메서드가 필요 한 경우

- **메서드 내리기**, **필드 내리기** 로 불필요한 프로퍼티와 메서드를 가진 서브 클래스로 넘기기
- 부모의 동작은 필요하나 인터페이스를 따르고 싶지 않은 경우 **서브클래스를 위임으로 바꾸기**, **슈퍼클래스를 위임으로 바꾸기**

## 3.24 주석

- **함수 추출하기** : 주석을 남겨야 겠다는 생각이 들면 주석이 필요없는 코드로 리팩터링하기
- **함수 선언바꾸기** : 추출 후에도 주석이 필요하다는 생각이 들 경우
- **어셔선 추가하기** : 시스템 동작 선행조건 명시
